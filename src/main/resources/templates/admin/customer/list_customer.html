<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi-VN" class="sapo-menu-expand sapo-menu-toggle-active">
<head>
    <th:block th:replace="/layout/header.html"/>
    <title>Danh sách khách hàng</title>
    <link rel="stylesheet" href="/assets/admin/css/customer/customer.css"/>
</head>
<body data-new-gr-c-s-check-loaded="14.1085.0" cz-shortcut-listen="true">
<div id="root" style="overflow: auto;">
    <th:block th:replace="/layout/menu.html"/>
    <div class="col-right MuiBox-root jss64 jss40">
        <div class="MuiBox-root jss440" id="header">
            <h3 class="MuiTypography-root MuiTypography-h3">Khách hàng</h3>
            <div class="MuiBox-root jss441">
                <div class="MuiBox-root jss442">
                    <svg class="MuiSvgIcon-root jss443" focusable="false" viewBox="0 0 24 24" color="#A2A8AF"
                         aria-hidden="true">
                        <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/>
                    </svg>
                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-colorTextPrimary">Vay vốn kinh
                        doanh</p>
                </div>
                <div class="MuiBox-root jss442">
                    <svg class="MuiSvgIcon-root jss443" focusable="false" viewBox="0 0 20 20" color="#A2A8AF"
                         aria-hidden="true">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                              d="M9.99992 0.833374C4.93992 0.833374 0.833252 4.94004 0.833252 10C0.833252 15.06 4.93992 19.1667 9.99992 19.1667C15.0599 19.1667 19.1666 15.06 19.1666 10C19.1666 4.94004 15.0599 0.833374 9.99992 0.833374ZM9.08325 16.4167V14.5834H10.9166V16.4167H9.08325ZM11.9891 10.1559L12.8141 9.31254C13.3366 8.79004 13.6666 8.05671 13.6666 7.25004C13.6666 5.22421 12.0258 3.58337 9.99992 3.58337C7.97409 3.58337 6.33325 5.22421 6.33325 7.25004H8.16659C8.16659 6.24171 8.99158 5.41671 9.99992 5.41671C11.0083 5.41671 11.8333 6.24171 11.8333 7.25004C11.8333 7.75421 11.6316 8.21254 11.2924 8.54254L10.1558 9.69754C9.49575 10.3667 9.08325 11.2834 9.08325 12.2917V12.75H10.9166C10.9166 11.375 11.3291 10.825 11.9891 10.1559Z"
                              fill="currentColor"/>
                    </svg>
                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-colorTextPrimary">Trợ giúp</p>
                </div>
                <div class="MuiBox-root jss442">
                    <svg class="MuiSvgIcon-root jss443" focusable="false" viewBox="0 0 16 14" color="#A2A8AF"
                         aria-hidden="true">
                        <path
                                d="M8 14C5.10929 11.4904 0 8.36868 0 4.19619C0 1.84632 1.936 0 4.4 0C5.792 0 7.128 0.578989 8 1.55556C8.872 0.578989 10.208 0 11.6 0C14.064 0 16 1.84632 16 4.19619C16 8.36185 10.8971 11.5039 8 14Z"
                                fill="currentColor"/>
                    </svg>
                    <p class="MuiTypography-root MuiTypography-body1" style="color: rgb(24, 37, 55);">Góp ý</p>
                </div>
                <div class="MuiBox-root jss442">
                    <div class=" sb-avatar sb-avatar--text"
                         style="display: inline-block; vertical-align: middle; width: 30px; height: 30px; border-radius: 20px; font-family: Helvetica, Arial, sans-serif;">
                        <div class="sb-avatar__text" title="Phú Nguyễn"
                             style="width: 30px; height: 30px; line-height: initial; text-align: center; color: rgb(255, 255, 255); border-radius: 20px; background: rgb(215, 61, 50);">
                            <div style="display: table; table-layout: fixed; width: 100%; height: 100%; font-size: 10px;">
                  <span style="display: table-cell; vertical-align: middle; white-space: nowrap;">
                    <span>P</span>
                  </span>
                            </div>
                        </div>
                    </div>
                    <p class="MuiTypography-root jss445 MuiTypography-body1 MuiTypography-colorTextPrimary">Phú
                        Nguyễn</p>
                    <svg class="MuiSvgIcon-root arrow-avatar" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"></path>
                    </svg>
                </div>
            </div>
        </div>
        <div class="MuiBox-root jss2447">
            <div class="MuiBox-root jss2448">
                <div class="MuiBox-root jss2457">
                    <button class="MuiButtonBase-root MuiButton-root MuiButton-textSizeSmall jss2464" tabindex="0"
                            type="button">
              <span class="MuiButton-label">
                <span class="MuiButton-startIcon MuiButton-iconSizeSmall">
                  <svg class="MuiSvgIcon-root jss2463" focusable="false" viewBox="0 0 14 20" aria-hidden="true">
                    <path d="M6 8.74228e-08L6 12.17L2.41 8.59L1 10L7 16L13 10L11.59 8.59L8 12.17L8 0L6 8.74228e-08Z"
                          fill="currentColor"></path>
                    <path d="M0 18H14V20H0V18Z" fill="currentColor"></path>
                  </svg>
                </span>Xuất file</span>
                        <span class="MuiTouchRipple-root"></span>
                    </button>
                    <button class="MuiButtonBase-root MuiButton-root MuiButton-textSizeSmall jss2464" tabindex="0"
                            type="button">
              <span class="MuiButton-label">
                <span class="MuiButton-startIcon MuiButton-iconSizeSmall">
                  <svg class="MuiSvgIcon-root jss2463" focusable="false" viewBox="0 0 14 20" aria-hidden="true">
                    <path
                            d="M8.00003 16L8.00003 3.83001L11.59 7.41001L13 6.00001L7.00003 1.29539e-06L1.00002 6.00001L2.41002 7.41001L6.00002 3.83001L6.00002 9.91501L6.00002 16L8.00003 16Z"
                            fill="currentColor"></path>
                    <path d="M14 20L1.90735e-06 20L2.08219e-06 18L14 18L14 20Z" fill="currentColor"></path>
                  </svg>
                </span>Nhập file</span>
                        <span class="MuiTouchRipple-root"></span>
                    </button>
                </div>
                <div class="MuiBox-root jss2457">
                    <a herf="/admin/customers/create" type="button">
                        <button id="Sapo-Button-836bcc52-4590-4897-a026-4876dfa7062b"
                                onclick="location.href='/admin/customers/create';" class="fEHNKi">
                            <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
                            </svg>
                            <span class="fCIlZX">Thêm khách hàng</span>
                        </button>

                    </a>

                </div>
            </div>
            <div class="MuiBox-root jss2449">
                <div class="MuiBox-root jss2450">
                    <div class="cTUhMx">
                        <div id="scroller" class="hYUFnd">
                            <div class="ieIWRo">
                                <button class="dvtKJo btnShowTableCustomer" id="btnShowTableCustomer">Tất cả khách
                                    hàng
                                </button>
                                <button type="button" id="active btnShowTableCustomerByStatus"
                                        class="btnShowTableCustomerByStatus ceoyok">Đang giao dịch
                                </button>

                            </div>
                        </div>
                    </div>

                </div>
                <div class="MuiPaper-root jss2056 sapo-grid MuiPaper-elevation1 MuiPaper-rounded MuiPaper-overflow">
                    <div class="MuiTableContainer-root jss2057 sapo-grid-header-wrapper stickyHeader"
                         style="top: 52px;">
                        <table id="showAllCustomerTable" class="table table-hover MuiTable-root jss2058 sapo-grid-header"
                               aria-labelledby="tableTitle"
                               aria-label="enhanced table">
                            <thead class="MuiTableHead-root jss2071">
                            <tr class="MuiTableRow-root MuiTableRow-head">
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignLeft"
                                    scope="col" colspan="1" rowspan="1">Mã khách hàng
                                </th>
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignLeft"
                                    scope="col" colspan="1" rowspan="1"><span
                                        class="MuiButtonBase-root MuiTableSortLabel-root jss2072" tabindex="0"
                                        role="button" aria-disabled="false">Tên khách hàng<svg viewBox="0 0 24 24"
                                                                                               fill="none"
                                                                                               xmlns="http://www.w3.org/2000/svg"
                                                                                               width="20" height="20"
                                                                                               font-size="20"
                                                                                               class="UnfoldMoreIcon"
                                                                                               color="#A3A8AF"><path
                                        d="m7 13.582 5 5.416 5-5.416H7ZM7 11.416 12 6l5 5.416H7Z" fill="#A3A8AF"></path></svg></span>
                                </th>
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignLeft"
                                    scope="col" colspan="1" rowspan="1">Số điện thoại
                                </th>
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignLeft"
                                    scope="col" colspan="1" rowspan="1">Nhóm khách hàng
                                </th>
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignRight"
                                    scope="col" colspan="1" rowspan="1"><span
                                        class="MuiButtonBase-root MuiTableSortLabel-root jss2072 right" tabindex="0"
                                        role="button" aria-disabled="false">Công nợ hiện tại<svg viewBox="0 0 24 24"
                                                                                                 fill="none"
                                                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                                                 width="20" height="20"
                                                                                                 font-size="20"
                                                                                                 class="UnfoldMoreIcon"
                                                                                                 color="#A3A8AF"><path
                                        d="m7 13.582 5 5.416 5-5.416H7ZM7 11.416 12 6l5 5.416H7Z" fill="#A3A8AF"></path></svg></span>
                                </th>
                                <th class="MuiTableCell-root MuiTableCell-head jss2075 MuiTableCell-alignRight"
                                    scope="col" colspan="1" rowspan="1"><span
                                        class="MuiButtonBase-root MuiTableSortLabel-root jss2072 right" tabindex="0"
                                        role="button" aria-disabled="false">Tổng chi tiêu<svg viewBox="0 0 24 24"
                                                                                              fill="none"
                                                                                              xmlns="http://www.w3.org/2000/svg"
                                                                                              width="20" height="20"
                                                                                              font-size="20"
                                                                                              class="UnfoldMoreIcon"
                                                                                              color="#A3A8AF"><path
                                        d="m7 13.582 5 5.416 5-5.416H7ZM7 11.416 12 6l5 5.416H7Z" fill="#A3A8AF"></path></svg></span>
                                </th>

                            </tr>
                            </thead>
                            <tbody class="MuiTableBody-root showAllCustomerInfo" id="showAllCustomerInfo">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<th:block th:replace="/layout/script.html"/>
<script>
    getAllCustomerInfo();

    function getAllCustomerInfo() {
        $(document).ready(function () {
            console.log("show all customer")
            $("#showAllCustomerTable").DataTable({
                ajax: {
                    contentType: 'application/json',
                    url: "http://localhost:8080/api/customers",
                    type: "GET",
                    dataSrc: ''
                },
                lengthMenu: [
                    [5, 10, 20, -1],
                    ["5", "10", "20", "All"]
                ],
                searching: true,

                columns: [
                    {data: 'customerCode'},
                    {data: 'name'},
                    {data: 'phone'},
                    {data: 'customerGroup'},
                    {data: 'debtTotal'},
                    {data: "spendTotal"}],
                columnDefs: [
                    {
                        targets: 0,
                        render: function (data, type, row, meta) {
                            return `<a href="/admin/customers/customerInfo/${row.id}">${row.customerCode}</a>`;
                        }
                    },
                    {
                        targets: 4,
                        render: function (data, type, row, meta) {
                            if(row.id == null){{
                                return `<span> -- </span>`
                            }}
                            return `<span>${row.id}</span>`
                        }
                    },

                    ],














            })
        })
    }

    function getAllCustomerInfoByStatus() {
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/customers/showAllCustomerMixInfoByStatus"
        })
            .done((data) => {

                console.log(data)
                $.each(data, (i, item) => {
                    customer = item;
                    if (customer.status == "AVAILABLE") {
                        customer.status = customer.status = "Ngừng giao dịch";
                    }
                    if (customer.status == "SUCCESS") {
                        customer.status = "Đang giao dịch"
                    }
                    if (customer.gender == "NU") {
                        customer.gender = "Nữ"
                    }
                    if (customer.gender == "NAM") {
                        customer.gender = "Nam"
                    }
                    if (customer.gender == "KHAC") {
                        customer.gender = "Khác"
                    }
                    console.log(customer)
                    let str = `
                         <tr class="MuiTableRow-root jss3687 MuiTableRow-hover" role="checkbox"
                                aria-checked="false" tabindex="-1">
                                 <td class="MuiTableCell-root MuiTableCell-body jss3690 MuiTableCell-paddingCheckbox"   style="padding-left: 44px;"><span   class="MuiButtonBase-root MuiIconButton-root jss3677 MuiCheckbox-root MuiCheckbox-colorPrimary jss3667 MuiIconButton-colorPrimary"   aria-disabled="false" style="margin: 0px;"><span
                                        class="MuiIconButton-label"><input class="jss3680" type="checkbox" data-indeterminate="false" value=""><span class="jss3668"                 font-size="small"></span></span><span
                                        class="MuiTouchRipple-root"></span></span></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                    <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiTypography-root MuiTypography-body1 MuiTypography-colorPrimary"
                                       href="/admin/customers/customerInfo/${customer.id}">${customer.customer_CODE || "---"}</a></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 cellClick MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       currentitem="false"
                                       style="width: fit-content; max-width: 100%; display: inline-block; vertical-align: middle;">
                                        ${customer.name || "---"}</p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 cellClick MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                        currentitem="false"
                                       style="width: fit-content; max-width: 100%; display: inline-block; vertical-align: middle;">
                                        ${customer.phone || "---"}</p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 cellClick MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       currentitem="false"
                                       style="width: fit-content; max-width: 100%; display: inline-block; vertical-align: middle;">
                                        ${customer.customer_GROUP || "---"}
                                        </p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignRight">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       style="padding-right: 6px;">
                                       ${customer.congno != null ? (new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(customer.congno)) : "0"}
                                       </p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignRight">

                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       style="padding-right: 6px;">${customer.chitieu != null ? (new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(customer.chitieu)) : "0"}</p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignRight">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap">${customer.sl_MH_DAMUA || 0}</p>
                                </td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 cellClick MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       data-tip="" currentitem="false"
                                       style="width: fit-content; max-width: 100%; display: inline-block; vertical-align: middle;">${customer.email || "---"}</p>
                                </td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft"
                                    style="padding: 0px 16px;">
                                    <div class="sc-jSMfEi csJERM"><span
                                            class="sc-eCYdqJ ccQLIN">${customer.status || "---"}</span></div>
                                </td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       data-tip="Nguyễn Huy Trúc" currentitem="false">${customer.nv_PHUTRACH || "---"}</p></td>

                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       data-tip="" currentitem="false">${customer.gender || "---"}</p></td>

                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                   ${customer.ngm_CUOICUNG != null ? moment(customer.ngm_CUOICUNG).format('DD-MM-yyyy') : "---"}</td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap"
                                       data-tip="Theo nhóm khách hàng" currentitem="false">
                                       ${customer.sl_SP_DAMUA || "0"}</p></td>
                                <td class="MuiTableCell-root MuiTableCell-body jss3693 MuiTableCell-alignLeft">
                                    <p class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap">
                                        ${customer.sl_SP_HOANTRA || "0"}</p></td>
                       </tr>
                    `;
                    $("#showAllCustomerInfo").append(str);

                });
            })
            .fail((jqXHR) => {
                console.log("chương trình show info của bn bị lỗi")

            })
    }

    function deleteEventButtonModelShow() {
        $('.btnShowTableCustomerByStatus').css({
            'color': 'rgb(116, 124, 135)',
            'border': 'none'
        })
        $('.btnShowTableCustomer').css({
            'color': 'rgb(116, 124, 135)',
            'border': 'none'
        })
        $('.showAllCustomerInfo').html("");
    }

    $('.btnShowTableCustomerByStatus').on('click', () => {
        deleteEventButtonModelShow();
        console.log("ok")
        $('.btnShowTableCustomerByStatus').css({
            'color': '#1190ff',
            'border-bottom': '2px solid rgb(0, 136, 255)'
        })
        getAllCustomerInfoByStatus();
    })
    $('.btnShowTableCustomer').on('click', () => {
        deleteEventButtonModelShow();
        console.log("ok")
        $('.btnShowTableCustomer').css({
            'color': '#1190ff',
            'border-bottom': '2px solid rgb(0, 136, 255)'
        })
        getAllCustomerInfo();
    })


</script>
<style>
    #showAllCustomerTable_length{
        margin-left: 1399px;
    }
    #showAllCustomerInfo{
        font-size: 14px;
    }
    .dataTables_wrapper .dataTables_filter {
        float: left;
        text-align: left;
    }
    .jss2075{
        font-size: 16px;
    }
    #showAllCustomerTable_filter{
        margin-top: -30px;
    }
    .dataTables_info{
        font-size: 15px;
    }
    .showAllCustomerTable_paginate{
        font-size: 15px;
    }
    /*.showAllCustomerTable_length{*/
    /*    font-size: 15px;*/
    /*}*/
    .dataTables_paginate paging_simple_numbers{
        font-size: 15px;

    }
    body {
        font-weight: 400;
        text-transform: none;
        letter-spacing: normal;
        font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
        color: #212b35;
        min-width: 1000px;
        font-size: 15px;
        line-height: 1.42857143;
        background-color: #fff;
    }
    .jss2450 {
        display: flex;
        min-height: 59px;
        flex-direction: column;
        background-color: white;
    }
    .dataTables_info{
        margin-left: 1044px;
    }
</style>
</html>